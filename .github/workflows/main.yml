on:
  push:
    branches:
      - master
  pull_request:
      branches:
        - master
  workflow_dispatch:
      branches:
        - Pipeline
        - master


name: GitHub Action for vsce

jobs:
  deploy:
    runs-on: windows-latest
    steps:
      
    - name: checkout
      uses: actions/checkout@v2
      
    - name: yarn
      run: yarn
    
    - name : current version
      run: |
        $version = (Get-Content .\package.json | ConvertFrom-Json).version
        Write-Host 'Current version from package.json: ' $version
         
    - name: next version
      run: $sem = "minor"
    
    - name: get published version
      run: |
        $headers = New-Object "System.Collections.Generic.Dictionary[[String],[String]]"
        $headers.Add("VSMarketplaceBadge", "1.0")
        $headers.Add("Accept", "application/json;api-version=3.0-preview.1")
        $headers.Add("Content-Type", "application/json")
        $body = "{`"filters`":[{`"criteria`":[{`"filterType`":7,`"value`":`"PrateekMahendrakar.PrettyXML`"},{`"filterType`":12,`"value`":4096}]}],`"flags`":914}"
        $response = Invoke-RestMethod 'https://marketplace.visualstudio.com/_apis/public/gallery/extensionquery' -Method Post -Headers $headers -Body $body
        $publishedVersion= $response.results[0].extensions.versions.version
        Write-Host 'Last Published version: '$publishedVersion 
